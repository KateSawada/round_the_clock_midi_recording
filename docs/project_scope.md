# プロジェクトスコープ定義

## 1. スコープ概要

### 1.1 プロジェクト名
Round the Clock MIDI Recording System

### 1.2 スコープ期間
Phase 1: 2024年1月 - 2024年3月（MVP開発）
Phase 2: 2024年4月 - 2024年6月（機能拡張）
Phase 3: 2024年7月以降（将来拡張）

### 1.3 開発アプローチ
段階的開発（MVP → 機能拡張 → 将来拡張）

## 2. Phase 1: MVP（Minimum Viable Product）

### 2.1 実装優先順位

#### **Priority 1: コア機能（最優先）**
- [ ] **MIDIイベント受信・蓄積**
  - 汎用的なMIDIデバイス対応
  - Note On/Off、Control Change等の基本メッセージ受信
  - メモリ上でのイベント蓄積
  - タイムスタンプ付きデータ記録

- [ ] **自動ファイル書き出し**
  - 設定可能なタイムアウト時間（デフォルト5分）
  - 自動ファイル名生成（yyyymmddhhmmss.mid形式）
  - ローカルディレクトリへの保存
  - **最重要**: イベント列を確実にファイルに保存

- [ ] **システム常時起動**
  - 24時間365日の安定動作
  - メモリ使用量管理（1GB制限）

#### **Priority 2: 基本GUI**
- [ ] **最小限GUI**
  - 録音停止・保存ボタンのみ
  - 録音状態表示（録音中/停止中）
  - 基本的なエラー表示

#### **Priority 3: 設定・ログ機能**
- [ ] **設定ファイル管理**
  - 基本的な設定項目（タイムアウト時間、出力ディレクトリ等）
  - 設定ファイルでの管理

- [ ] **ログ機能**
  - ファイル保存完了のログ
  - 録音自動停止のログ
  - 録音自動開始のログ
  - エラーログ
  - タイムスタンプと内容をセットで出力

#### **Priority 4: エラーハンドリング**
- [ ] **堅牢性確保**
  - イベント列のファイル保存を最優先
  - 基本的なエラー復旧機能
  - システムクラッシュ時のデータ保護

### 2.2 含まれない機能（Phase 2以降）
- 複数デバイス同時接続
- デバイス優先順位設定
- 高度なGUI機能（波形表示、設定画面等）
- ネットワークストレージ対応
- データ可視化機能
- CSV、JSON等の代替ファイル形式

### 2.3 技術制約
- **使用ライブラリ**: Python + mido + flet 0.28.3
- **対応OS**: macOS（開発環境）
- **メモリ制限**: 最大1GB
- **ファイル形式**: MIDIファイル（.mid）のみ
- **デバイス対応**: 汎用的なMIDIデバイス対応
- **環境構築**: uvを使用した依存関係管理

## 3. Phase 2: 機能拡張

### 3.1 追加機能
- [ ] **デバイス管理強化**
  - preferred_devicesリストによる優先順位設定
  - 複数デバイス対応
  - デバイス接続状態の監視

- [ ] **設定機能強化**
  - 詳細な設定項目の追加
  - GUIからの設定変更
  - 設定の永続化

- [ ] **エラーハンドリング強化**
  - 詳細なエラーログ
  - 自動復旧機能
  - ユーザーフレンドリーなエラー表示

- [ ] **GUI機能拡張**
  - デバイス選択画面
  - 設定画面
  - 録音履歴表示

### 3.2 技術拡張
- 設定ファイル管理（configparser/yaml）
- ログ機能（logging）
- エラーハンドリング強化

## 4. Phase 3: 将来拡張

### 4.1 追加機能
- [ ] **ネットワークストレージ対応**
  - クラウドストレージ連携
  - ネットワークドライブ対応
  - 自動同期機能

- [ ] **データ分析機能**
  - 録音データの可視化
  - 統計情報の表示
  - データエクスポート機能

- [ ] **高度なGUI機能**
  - リアルタイム波形表示
  - 録音データの再生機能
  - 高度な設定画面

### 4.2 技術拡張
- ネットワークライブラリ（requests, ftplib等）
- データ可視化ライブラリ（matplotlib, plotly等）
- データベース連携（SQLite等）

## 5. 成功基準

### 5.1 Phase 1 成功基準
- [ ] 汎用的なMIDIデバイスから正常にデータを受信できる
- [ ] 5分間イベントなしで自動的にファイルに保存される
- [ ] **最重要**: イベント列が確実にファイルに保存される
- [ ] GUIから録音停止・保存ができる
- [ ] 24時間連続動作が可能
- [ ] メモリ使用量が1GB以下に収まる
- [ ] 設定ファイルで動作を制御できる
- [ ] 必要なログが適切に出力される

### 5.2 Phase 2 成功基準
- [ ] 複数のMIDIデバイスに対応できる
- [ ] 詳細な設定ファイルで動作を制御できる
- [ ] エラー時に適切なフィードバックが表示される
- [ ] GUIから全ての主要機能にアクセスできる

### 5.3 Phase 3 成功基準
- [ ] ネットワークストレージに自動保存できる
- [ ] 録音データの可視化ができる
- [ ] 高度な分析機能が利用できる

## 6. リスク管理

### 6.1 Phase 1 リスク
- **技術リスク**: midoライブラリの制限
- **対策**: 複数のMIDIデバイスでのテスト

- **データ損失リスク**: イベント列の保存失敗
- **対策**: 複数の保存方法とエラーハンドリング強化

- **スケジュールリスク**: 初回開発のため予想外の時間がかかる
- **対策**: 週次での進捗確認とスコープ調整

### 6.2 Phase 2 リスク
- **複雑性リスク**: 機能追加による複雑化
- **対策**: 段階的な機能追加と十分なテスト

### 6.3 Phase 3 リスク
- **技術リスク**: ネットワーク機能の実装複雑性
- **対策**: 外部ライブラリの慎重な選択

## 7. 次のアクション

### 7.1 即座に実行可能（Priority 1）
1. **環境セットアップ**
   - flet 0.28.3のインストール
   - 開発環境の構築

2. **コア機能開発**
   - 基本的なMIDI監視機能の実装
   - タイマー機能の実装
   - 自動ファイル書き出し機能の実装
   - **最重要**: イベント列の確実な保存機能

### 7.2 並行して進める（Priority 2-4）
1. **基本GUI開発**
   - 録音停止・保存ボタンの実装
   - 録音状態表示の実装

2. **設定・ログ機能**
   - 設定ファイル管理の実装
   - ログ機能の実装

3. **エラーハンドリング**
   - 基本的なエラーハンドリングの実装
   - データ保護機能の実装

### 7.3 テスト計画
1. **単体テスト**
   - MIDI受信機能のテスト
   - ファイル書き出し機能のテスト
   - タイマー機能のテスト

2. **統合テスト**
   - エンドツーエンドの録音テスト
   - 長時間動作テスト
   - エラー復旧テスト

## 8. スコープ変更管理

### 8.1 変更基準
- イベント列の保存機能は絶対に削除しない
- 機能追加はPhase 2以降に延期
- バグ修正は即座に対応
- セキュリティ問題は最優先で対応

### 8.2 変更プロセス
1. 変更要求の提出
2. 影響度評価
3. スコープ調整
4. スケジュール更新

## 9. 承認・確認

### 9.1 承認者
- 開発者（自分自身）

### 9.2 確認事項
- [x] Phase 1のスコープが適切か
- [x] 技術的制約が現実的か
- [x] スケジュールが実行可能か
- [x] リスク対策が十分か
- [x] イベント列の保存が最優先されているか 
