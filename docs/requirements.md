# MIDIデバイスデータ記録システム 要件定義

## 1. プロジェクト概要

### 1.1 プロジェクト名
Round the Clock MIDI Recording System

### 1.2 プロジェクトの目的
midoライブラリを使用して、MIDIデバイスから送信されたデータを自動的にファイルに記録するシステムを開発する。システムは常時起動し、一定時間MIDIイベントが送信されなかった場合に、それまでのイベントをMIDIファイルに書き出す。

### 1.3 背景・課題
- MIDIデバイスからの演奏データを永続化したい
- システムを常時起動させておき、自動的にデータを記録したい
- 記録されたデータの後処理・分析が可能である必要がある
- メモリ使用量を最小限に抑えたい

## 2. 機能要件

### 2.1 基本機能
- [ ] システムの常時起動
- [ ] MIDIデバイスの検出・接続
- [ ] MIDIイベントの受信・蓄積
- [ ] 一定時間イベントなし時の自動ファイル書き出し
- [ ] ファイル書き出し後のメモリクリア
- [ ] システム状態の監視・表示
- [ ] GUIインターフェース
- [ ] 手動録音停止・保存機能

### 2.2 データ記録機能
- [ ] MIDIメッセージの種類別記録（Note On/Off、Control Change等）
- [ ] タイムスタンプ付きデータ記録
- [ ] MIDIファイル形式での出力
- [ ] 自動ファイル名生成（yyyymmddhhmmss.mid形式）
- [ ] メモリ上のイベント蓄積
- [ ] ローカルストレージへの保存
- [ ] ネットワークストレージへの保存（将来拡張予定）

### 2.3 自動化機能
- [ ] 一定時間（設定可能）イベントなしの検出
- [ ] 自動ファイル書き出し処理
- [ ] 書き出し後のメモリクリア
- [ ] 次のイベント受信時の自動記録再開

### 2.4 設定・カスタマイズ機能
- [ ] 記録対象デバイスの選択
- [ ] ファイル出力先の指定
- [ ] イベントなし検出時間の設定
- [ ] デバイス優先順位の設定（preferred_devicesリストの順序）
- [ ] 接続中デバイス一覧からの選択機能

### 2.5 GUI機能
- [ ] 手動保存ボタンの配置
- [ ] 現在の録音状態の表示
- [ ] 手動保存時のファイル名指定機能
- [ ] 手動保存先ディレクトリの設定
- [ ] 保存完了時のフィードバック表示

## 3. 非機能要件

### 3.1 性能要件
- 常時起動：24時間365日の安定動作
- メモリ効率：最大1GBまでのメモリ使用量
- 安定性：長時間の連続動作に対応

### 3.2 互換性要件
- 複数のMIDIデバイスに対応
- 異なるOSでの動作（Windows、macOS、Linux）
- 様々なMIDIメッセージタイプに対応

### 3.3 ユーザビリティ要件
- システム状態の監視機能
- ログ出力による動作状況の把握
- エラー時の適切なフィードバック

## 4. 技術要件

### 4.1 使用技術
- **言語**: Python
- **MIDIライブラリ**: mido
- **GUIライブラリ**: flet
- **その他ライブラリ**: 必要に応じて追加

### 4.2 開発環境
- Python 3.8以上
- 仮想環境の使用
- 依存関係管理（pyproject.toml）

## 5. 制約事項

### 5.1 技術的制約
- midoライブラリの制限
- システムリソースの制限
- MIDIデバイスの仕様制限

### 5.2 運用制約
- ファイルサイズの管理
- ディスク容量の考慮
- プライバシー・セキュリティの配慮

## 6. 成功基準

### 6.1 機能的な成功基準
- [ ] システムが常時起動し、MIDIデバイスからのデータを正常に受信できる
- [ ] 一定時間イベントなしを検出し、自動的にファイルに書き出せる
- [ ] ファイル書き出し後にメモリが正常にクリアされる
- [ ] 次のイベント受信時に自動的に記録を再開できる
- [ ] ファイル名がyyyymmddhhmmss.mid形式で生成される
- [ ] preferred_devicesリストの順序に基づいてデバイスが選択される
- [ ] 接続中のデバイス一覧から適切にデバイスが選択される
- [ ] 選択されたデバイスが継続的に使用される
- [ ] GUIから手動で録音を停止・保存できる
- [ ] 手動保存時に適切なファイル名で保存される

### 6.2 非機能的な成功基準
- [ ] 24時間365日の安定動作が可能
- [ ] メモリ使用量が適切に管理される
- [ ] 複数のMIDIデバイスに対応できる

## 7. リスク分析

### 7.1 技術リスク
- MIDIデバイスの互換性問題
- 長時間動作によるメモリリーク
- ファイルI/Oのエラー

### 7.2 対策
- 複数デバイスでのテスト
- メモリ監視・最適化
- エラーハンドリングの実装

## 8. 今後の検討事項

### 8.1 拡張機能
- GUIインターフェース
- データ可視化機能
- ネットワーク転送機能
- 複数フォーマット出力（CSV、JSON等）
- ネットワークストレージへの自動保存機能
- クラウドストレージ連携機能

### 8.2 運用・保守
- ログ機能
- 設定ファイル管理
- アップデート機能
